#include "FS.h"
#include "LittleFS.h"

#define WIFI_CREDENTIALS_FILE "/wifi_credentials.txt"  // Correct path

// Function prototype (declare before setup)
void readFile(fs::FS &fs, const char *filename);

void setup() {
  Serial.begin(115200);

  if (!LittleFS.begin(true)) {  // True enables formatting if needed
    Serial.println("‚ö†Ô∏è LittleFS Mount Failed!");
    return;
  }

  Serial.println("‚úÖ LittleFS Mounted Successfully");

  // Read WiFi credentials from the file
  listFiles();
  if (!LittleFS.exists(WIFI_CREDENTIALS_FILE)) {
    Serial.println("‚ö†Ô∏è WiFi credentials file not found! Creating a new one...");
    writeWiFiCredentials();
}


  readFile(LittleFS, WIFI_CREDENTIALS_FILE);
}

void readFile(fs::FS &fs, const char *filename) {
  Serial.printf("üìÇ Reading file: %s\n", filename);
  
  File file = fs.open(filename, "r");
  if (!file) {
    Serial.println("‚ùå Failed to open file for reading");
    return;
  }

  while (file.available()) {
    Serial.write(file.read());  // Print file content
  }
  
  file.close();
}
void loop() {
  // Your main loop code goes here
}

void listFiles() {
  Serial.println("üìÇ Listing files in LittleFS:");
  File root = LittleFS.open("/");
  File file = root.openNextFile();
  while (file) {
    Serial.printf("üìÑ %s\n", file.name());
    file = root.openNextFile();
  }
}

void writeWiFiCredentials() {
  Serial.println("‚úçÔ∏è Writing default WiFi credentials...");

  File file = LittleFS.open("/wifi_credentials.txt", "w");
  if (!file) {
    Serial.println("‚ùå Failed to create WiFi credentials file!");
    return;
  }

  file.println("MyWiFiSSID,MyWiFiPassword"); // Replace with actual credentials
  file.close();
  Serial.println("‚úÖ WiFi credentials saved.");
}



